# 单模态人脸识别使用指南

本指南介绍如何使用已实现的单模态人脸识别系统进行训练和测试。

## 项目结构

```
├── configs/face_config.yaml      # 单模态人脸识别配置文件
├── core/
│   ├── datasets.py               # 人脸数据集类
│   ├── models/face_net.py        # 人脸识别模型
│   └── utils.py                  # 工具函数
├── train.py                      # 训练脚本
├── test.py                       # 测试脚本
└── data/face/                    # 人脸数据目录
```

## 数据准备

### 数据格式要求

1. 将人脸图像按照类别（身份）组织在不同的文件夹中
2. 支持的图像格式：`.jpg`, `.jpeg`, `.png`, `.bmp`
3. 建议图像分辨率：至少224x224像素

### 示例目录结构

```
data/face/
├── person_001/
│   ├── face_001.jpg
│   ├── face_002.jpg
│   └── ...
├── person_002/
│   ├── face_001.jpg
│   ├── face_002.jpg
│   └── ...
└── ...
```

## 训练模型

### 基本训练

```bash
# 使用默认配置训练
python train.py --config configs/face_config.yaml
```

### 自定义训练

```bash
# 指定实验名称
python train.py --config configs/face_config.yaml --experiment_name my_face_experiment

# 指定GPU设备
python train.py --config configs/face_config.yaml --device cuda:0

# 从检查点恢复训练
python train.py --config configs/face_config.yaml --resume checkpoints/face/checkpoint_epoch_10.pth
```

### 训练参数说明

- **epochs**: 训练轮数（默认50）
- **batch_size**: 批次大小（默认32）
- **learning_rate**: 学习率（默认0.001）
- **face_embedding_dim**: 特征维度（默认512）
- **pretrained**: 是否使用预训练权重（默认true）

## 测试模型

### 基本测试

```bash
# 使用最新检查点测试
python test.py --config configs/face_config.yaml
```

### 指定检查点测试

```bash
# 使用特定检查点
python test.py --config configs/face_config.yaml --checkpoint checkpoints/face/checkpoint_best.pth

# 指定输出目录
python test.py --config configs/face_config.yaml --output_dir results/my_test
```

## 配置文件说明

### face_config.yaml 参数详解

```yaml
# 训练配置
training:
  epochs: 50                    # 训练轮数
  batch_size: 32               # 批次大小
  learning_rate: 0.001         # 初始学习率
  weight_decay: 1e-4          # 权重衰减
  momentum: 0.9               # SGD动量
  scheduler_step: 20          # 学习率衰减步长
  scheduler_gamma: 0.1        # 学习率衰减因子

# 模型配置
model:
  model_type: 'facenet'       # 模型类型
  face_embedding_dim: 512     # 特征维度
  num_classes: 100           # 类别数（自动检测）
  pretrained: true           # 使用预训练权重
  dropout_rate: 0.5          # dropout概率

# 数据配置
data:
  face_image_size: 224       # 输入图像大小

# 路径配置
paths:
  face_data_dir: './data/face'              # 人脸数据目录
  checkpoint_dir: './checkpoints/face'      # 检查点保存目录
  log_dir: './logs/face'                   # 日志目录
  results_dir: './results/face'            # 结果目录
```

## 输出文件

### 训练输出

- **检查点**: `checkpoints/face/checkpoint_*.pth`
- **日志**: `logs/face/training.log`
- **TensorBoard**: `logs/face/实验名/`
- **训练曲线**: `logs/face/实验名/training_curves.png`

### 测试输出

- **结果文件**: `results/face/test_results.json`
- **混淆矩阵**: `results/face/confusion_matrix.png`
- **详细指标**: 控制台输出和JSON文件

## 性能指标

系统计算以下指标：

- **准确率 (Accuracy)**: 整体分类准确率
- **精确率 (Precision)**: 各类别预测准确率
- **召回率 (Recall)**: 各类别覆盖率
- **F1分数**: 精确率和召回率的调和平均值

## 故障排除

### 常见问题

1. **数据目录不存在**
   - 确保 `data/face/` 目录存在并包含按类别组织的图像

2. **CUDA内存不足**
   - 减小 `batch_size`
   - 使用 `--device cpu` 在CPU上运行

3. **类别数不匹配**
   - 检查数据目录结构
   - 确保配置文件中的 `num_classes` 与实际类别数一致

4. **训练不收敛**
   - 调整学习率
   - 增加训练轮数
   - 检查数据质量

### 调试模式

启用调试模式获取更多信息：

```yaml
debug:
  debug_mode: true
  max_samples: 1000  # 限制样本数量
```

## 学术研究建议

### 消融实验

1. **预训练权重影响**:
   ```yaml
   model:
     pretrained: false  # 对比实验
   ```

2. **特征维度影响**:
   ```yaml
   model:
     face_embedding_dim: 256  # 对比512
   ```

3. **数据增强影响**:
   ```yaml
   data:
     use_augmentation: false  # 关闭数据增强
   ```

### 性能评估

- 使用独立的测试集评估泛化能力
- 计算每类的精确率/召回率
- 分析混淆矩阵中的错误模式

## 下一步

完成单模态人脸识别后，可以：

1. 实现单模态指纹识别
2. 开发多模态融合模型
3. 进行对比实验和性能分析

---

**注意**: 所有路径都是相对于项目根目录的。如有问题，请检查配置文件和数据格式。